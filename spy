local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local saymsg = ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents"):WaitForChild("SayMessageRequest")
local getmsg = ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents"):WaitForChild("OnMessageDoneFiltering")

local player = Players.LocalPlayer
local spyEnabled = false
local chatLogs = {}

-- Create GUI
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
screenGui.Name = "ChatSpyGUI"

-- Toggle Button for Chat Spy
local toggleButton = Instance.new("TextButton", screenGui)
toggleButton.Size = UDim2.new(0, 150, 0, 50)
toggleButton.Position = UDim2.new(0.85, 0, 0.1, 0)
toggleButton.Text = "Enable Chat Spy"
toggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 18

-- Creator Label
local creatorButton = Instance.new("TextButton", screenGui)
creatorButton.Size = UDim2.new(0, 200, 0, 40)
creatorButton.Position = UDim2.new(0.85, 0, 0.17, 0)
creatorButton.Text = "Created by GodAmirr"
creatorButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
creatorButton.TextColor3 = Color3.fromRGB(255, 255, 0)
creatorButton.Font = Enum.Font.SourceSansBold
creatorButton.TextSize = 16
creatorButton.AutoButtonColor = false  -- Prevents clicking effect

local function logMessage(speaker, msg, recipient)
    local logText = "[" .. speaker .. "]: " .. msg
    if recipient then
        logText = logText .. " (To: " .. recipient .. ")"
    end
    table.insert(chatLogs, logText)
    StarterGui:SetCore("ChatMakeSystemMessage", {
        Text = "{SPY} " .. logText;
        Color = Color3.fromRGB(0, 255, 0);
        Font = Enum.Font.SourceSansBold;
        TextSize = 16;
    })
end

local function onMessageFiltered(packet, channel)
    if spyEnabled and packet.MessageType == "PrivateMessage" then
        local speaker = Players:GetPlayerByUserId(packet.SpeakerUserId)
        local recipient = Players:GetPlayerByUserId(packet.TargetId)
        if speaker and recipient then
            logMessage(speaker.Name, packet.Message, recipient.Name)
        end
    end
end

getmsg.OnClientEvent:Connect(onMessageFiltered)

toggleButton.MouseButton1Click:Connect(function()
    spyEnabled = not spyEnabled
    toggleButton.Text = spyEnabled and "Disable Chat Spy" or "Enable Chat Spy"
    StarterGui:SetCore("ChatMakeSystemMessage", {
        Text = "{SPY " .. (spyEnabled and "ENABLED" or "DISABLED") .. "}";
        Color = Color3.fromRGB(255, 255, 0);
        Font = Enum.Font.SourceSansBold;
        TextSize = 18;
    })
end)
